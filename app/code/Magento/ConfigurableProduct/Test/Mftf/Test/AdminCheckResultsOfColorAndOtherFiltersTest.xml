<?xml version="1.0" encoding="UTF-8"?>
<!--
 /**
  * Copyright Â© Magento, Inc. All rights reserved.
  * See COPYING.txt for license details.
  */
-->
<tests xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xsi:noNamespaceSchemaLocation="urn:magento:mftf:Test/etc/testSchema.xsd">
    <test name="AdminCheckResultsOfColorAndOtherFiltersTest">
        <annotations>
            <features value="ConfigurableProduct"/>
            <stories value="Checking filters results"/>
            <title value="Checking results of color and other filters"/>
            <description value="Checking results of filters: color and other filters"/>
            <severity value="MAJOR"/>
            <testCaseId value="MC-6192"/>
            <useCaseId value="MAGETWO-91753"/>
            <group value="ConfigurableProduct"/>
        </annotations>
        <before>
            <!-- Login as Admin -->
            <actionGroup ref="LoginAsAdmin" stepKey="loginAsAdmin"/>
            <!-- Create default category with subcategory -->
            <createData entity="ApiCategory" stepKey="createCategory"/>
            <createData entity="SubCategoryWithParent" stepKey="createSubcategory">
                <requiredEntity createDataKey="createCategory"/>
            </createData>
            <!-- Add first attribute with options -->
            <createData entity="productAttributeWithTwoOptions" stepKey="createConfigProductAttribute"/>
            <createData entity="productAttributeOption1" stepKey="createConfigProductAttributeOption1">
                <requiredEntity createDataKey="createConfigProductAttribute"/>
            </createData>
            <createData entity="productAttributeOption2" stepKey="createConfigProductAttributeOption2">
                <requiredEntity createDataKey="createConfigProductAttribute"/>
            </createData>
            <createData entity="productAttributeOption3" stepKey="createConfigProductAttributeOption3">
                <requiredEntity createDataKey="createConfigProductAttribute"/>
            </createData>
            <createData entity="productAttributeOption4" stepKey="createConfigProductAttributeOption4">
                <requiredEntity createDataKey="createConfigProductAttribute"/>
            </createData>
            <createData entity="productAttributeOption5" stepKey="createConfigProductAttributeOption5">
                <requiredEntity createDataKey="createConfigProductAttribute"/>
            </createData>
            <!-- Add second attribute with options-->
            <createData entity="multipleSelectProductAttribute" stepKey="createConfigProductAttribute2"/>
            <createData entity="productAttributeOption1" stepKey="createConfigProductAttributeOption12">
                <requiredEntity createDataKey="createConfigProductAttribute2"/>
            </createData>
            <createData entity="productAttributeOption2" stepKey="createConfigProductAttributeOption6">
                <requiredEntity createDataKey="createConfigProductAttribute2"/>
            </createData>
            <createData entity="productAttributeOption3" stepKey="createConfigProductAttributeOption7">
                <requiredEntity createDataKey="createConfigProductAttribute2"/>
            </createData>
            <createData entity="productAttributeOption4" stepKey="createConfigProductAttributeOption8">
                <requiredEntity createDataKey="createConfigProductAttribute2"/>
            </createData>
            <!-- Add created attributes with options to Attribute Set -->
            <actionGroup ref="AdminAddUnsignedAttributeToGroup" stepKey="createDefaultAttributeSet">
                <argument name="label" value="mySet"/>
                <argument name="firstOption" value="$$createConfigProductAttribute.attribute_code$$"/>
                <argument name="secondOption" value="$$createConfigProductAttribute2.attribute_code$$"/>
                <argument name="group" value="Product Details"/>
            </actionGroup>
            <!-- Create three configurable products with options -->
            <amOnPage url="{{AdminProductIndexPage.url}}" stepKey="amOnProductGridPage"/>
            <waitForPageLoad time="30" stepKey="wait1"/>
            <click selector="{{AdminProductGridActionSection.addProductToggle}}" stepKey="clickOnAddProductToggle"/>
            <click selector="{{AdminProductGridActionSection.addConfigurableProduct}}" stepKey="clickOnAddConfigurableProduct"/>
            <!-- Create First configurable product with options -->
            <actionGroup ref="CreateConfigurableProductWithAttributeSet" stepKey="createProductFirst">
                <argument name="product" value="ConfigurableProductWithAttributeSet1"/>
                <argument name="category" value="$$createCategory$$"/>
                <argument name="label" value="mySet"/>
                <argument name="option1" value="['option1', 'option2', 'option3', 'option4']"/>
            </actionGroup>
            <actionGroup ref="AdminCreateConfigurationsForAttribute" stepKey="createConfigurationFirst">
                <argument name="attributeCode" value="$$createConfigProductAttribute.attribute_code$$"/>
                <argument name="price" value="34"/>
            </actionGroup>
            <waitForPageLoad stepKey="waitForPageLoad"/>
            <click selector="{{AdminProductFormActionSection.saveArrow}}" stepKey="openSaveDropDown"/>
            <click selector="{{AdminGridMainControls.saveAndNew}}" stepKey="clickToSaveAndNew"/>
            <seeElement selector="{{AdminProductMessagesSection.successMessage}}" stepKey="seeSaveProductMessageFiest"/>
            <!-- Create Second configurable product with options -->
            <actionGroup ref="CreateConfigurableProductWithAttributeSet" stepKey="createProductSecond">
                <argument name="product" value="ConfigurableProductWithAttributeSet2"/>
                <argument name="category" value="$$createCategory$$"/>
                <argument name="label" value="mySet"/>
                <argument name="option1" value="['option1', 'option2', 'option3']"/>
            </actionGroup>
            <actionGroup ref="AdminCreateConfigurableProductWithAttributeUncheckOption" stepKey="createConfigurationSecond">
                <argument name="attributeCode" value="$$createConfigProductAttribute.attribute_code$$"/>
                <argument name="price" value="34"/>
                <argument name="attributeOption" value="option5"/>
            </actionGroup>
            <waitForPageLoad stepKey="waitForPageLoadThird"/>
            <click selector="{{AdminProductFormActionSection.saveArrow}}" stepKey="openSaveDropDownThird"/>
            <click selector="{{AdminGridMainControls.saveAndNew}}" stepKey="clickToSaveAndNewThird"/>
            <seeElement selector="{{AdminProductMessagesSection.successMessage}}" stepKey="seeSaveProductMessageSecond"/>
            <!-- Create Third configurable product with options -->
            <actionGroup ref="CreateConfigurableProductWithAttributeSet" stepKey="createProductThird">
                <argument name="product" value="ConfigurableProductWithAttributeSet3"/>
                <argument name="category" value="$$createCategory$$"/>
                <argument name="label" value="mySet"/>
                <argument name="option1" value="['option2', 'option3', 'option4']"/>
            </actionGroup>
            <actionGroup ref="AdminCreateConfigurableProductWithAttributeUncheckOption" stepKey="createConfigurationThird">
                <argument name="attributeCode" value="$$createConfigProductAttribute.attribute_code$$"/>
                <argument name="price" value="34"/>
                <argument name="attributeOption" value="option1"/>
            </actionGroup>
            <click selector="{{AdminGridMainControls.save}}" stepKey="clickToSaveButton"/>
            <waitForPageLoad stepKey="waitForProductPage"/>
            <seeElement selector="{{AdminProductMessagesSection.successMessage}}" stepKey="seeSaveConfigurableProductMessage"/>
            <amOnPage url="{{AdminProductIndexPage.url}}" stepKey="amOnProductGridPageAgain"/>
            <waitForPageLoad stepKey="waitForPageLoadForth"/>
            <click selector="{{AdminProductGridActionSection.addProductToggle}}" stepKey="clickOnAddProductToggleAgain"/>
            <click selector="{{AdminProductGridActionSection.addSimpleProduct}}" stepKey="clickOnAddSimpleProduct"/>
            <!-- Create Simple product with options -->
            <actionGroup ref="CreateConfigurableProductWithAttributeSet" stepKey="createSimpleProduct">
                <argument name="product" value="ApiSimpleProduct"/>
                <argument name="category" value="$$createCategory$$"/>
                <argument name="label" value="mySet"/>
                <argument name="option1" value="['option1', 'option2']"/>
            </actionGroup>
            <click selector="{{AdminGridMainControls.save}}" stepKey="clickToSave"/>
            <waitForPageLoad stepKey="waitForNewSimpleProductPage"/>
            <seeElement selector="{{AdminProductMessagesSection.successMessage}}" stepKey="seeSaveProductMessageThird"/>
        </before>
        <after>
            <!-- Delete all created data -->
            <deleteData createDataKey="createCategory" stepKey="deleteCategory"/>
            <!-- Delete attribute set -->
            <actionGroup ref="deleteAttributeSetByLabel" stepKey="deleteAttributeSet">
                <argument name="label" value="mySet"/>
            </actionGroup>
            <!-- Delete First attribute -->
            <actionGroup ref="SearchAttributeByCodeOnProductAttributeGridActionGroup" stepKey="searchAttributeByCodeOnProductAttributeGrid">
                <argument name="productAttributeCode" value="$$createConfigProductAttribute.attribute_code$$"/>
            </actionGroup>
            <actionGroup ref="OpenProductAttributeFromSearchResultInGridActionGroup" stepKey="openProductAttributeFromSearchResultInGrid">
                <argument name="productAttributeCode" value="$$createConfigProductAttribute.attribute_code$$"/>
            </actionGroup>
            <actionGroup ref="DeleteProductAttributeByAttributeCodeActionGroup" stepKey="deleteProductAttributeByAttributeCode">
                <argument name="productAttributeCode" value="$$createConfigProductAttribute.attribute_code$$"/>
            </actionGroup>
            <!-- Delete Second attribute -->
            <actionGroup ref="SearchAttributeByCodeOnProductAttributeGridActionGroup" stepKey="searchSecondAttributeByCodeOnProductAttributeGrid">
                <argument name="productAttributeCode" value="$$createConfigProductAttribute2.attribute_code$$"/>
            </actionGroup>
            <actionGroup ref="OpenProductAttributeFromSearchResultInGridActionGroup" stepKey="openSecondProductAttributeFromSearchResultInGrid">
                <argument name="productAttributeCode" value="$$createConfigProductAttribute2.attribute_code$$"/>
            </actionGroup>
            <actionGroup ref="DeleteProductAttributeByAttributeCodeActionGroup" stepKey="deleteSecondProductAttributeByAttributeCode">
                <argument name="productAttributeCode" value="$$createConfigProductAttribute2.attribute_code$$"/>
            </actionGroup>
            <!-- Log out -->
            <actionGroup ref="logout" stepKey="logout"/>
        </after>
        <!-- Open a category on storefront -->
        <actionGroup ref="StorefrontGoToCategoryPageActionGroup" stepKey="goToCategoryPage">
            <argument name="categoryName" value="$$createCategory.name$$"/>
        </actionGroup>
        <!-- Choose First attribute filter -->
        <waitForElementVisible selector="{{StorefrontCategorySidebarSection.filterOptionTitle('$$createConfigProductAttribute.default_frontend_label$$')}}" stepKey="waitForCartRuleButton"/>
        <click selector="{{StorefrontCategorySidebarSection.filterOptionTitle('$$createConfigProductAttribute.default_frontend_label$$')}}" stepKey="expandFirstAttribute"/>
        <waitForPageLoad stepKey="waitForFilterLoad"/>
        <click selector="{{StorefrontCategorySidebarSection.filterOptionContent('$$createConfigProductAttribute.default_frontend_label$$','option2')}}" stepKey="expandFirstAttributeOption"/>
        <waitForPageLoad stepKey="waitForAttributeOption"/>
        <see userInput="{{ConfigurableProductWithAttributeSet3.name}}" stepKey="seeFirstProduct"/>
        <see userInput="{{ConfigurableProductWithAttributeSet2.name}}" stepKey="seeSecondProduct"/>
        <see userInput="{{ConfigurableProductWithAttributeSet1.name}}" stepKey="seeThirdProduct"/>
        <actionGroup ref="StorefrontGoToCategoryPageActionGroup" stepKey="goToCategoryPageAgain">
            <argument name="categoryName" value="$$createCategory.name$$"/>
        </actionGroup>
        <!-- Choose Second attribute filter -->
        <click selector="{{StorefrontCategorySidebarSection.filterOptionTitle('$$createConfigProductAttribute2.default_frontend_label$$')}}" stepKey="expandSecondAttributeOption"/>
        <waitForPageLoad stepKey="waitForFilterPageLoad"/>
        <click selector="{{StorefrontCategorySidebarSection.filterOptionContent('$$createConfigProductAttribute2.default_frontend_label$$','option1')}}" stepKey="expandSecondAttribute"/>
        <see userInput="{{ConfigurableProductWithAttributeSet1.name}}" stepKey="seeFourthProduct"/>
        <see userInput="{{ConfigurableProductWithAttributeSet2.name}}" stepKey="seeFifthProduct"/>
    </test>
</tests>
